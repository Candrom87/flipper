<!DOCTYPE html>
<html>
<head>

	<title>Flipper | Watchening Ethereum Flippening Happening</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<!--all favicon stuff-->
	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32">
	<link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16">
	<link rel="manifest" href="/manifest.json">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="theme-color" content="#ffffff">
</head>

<body>

	<div id="container" class="container">
    <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills pull-right">

            <li role="presentation"><a href="https://reddit.com/u/malefizer">u/malefizer</a></li>
          </ul>
        </nav>
        <h3 class="text"><small>Watchening the Flippening Happening</small></h3>
      </div>

		<div id="content" class="jumbotron">

      <h2><strong>Does it flip?</strong></h2>

      <h2>ETH: <span class="text-right"><span class="display_eth_marcap number"> </span> USD</span></h2>
      <h2>BTC: <span class="text-right"><span class="display_btc_marcap number"> </span> USD</span></h2>

      <h1>ETH/BTC <strong>~<span class="display_ethbtc_pc"> </span>%</strong> <h1>
      <p class="text-muted">or more precise <span class="display_ethbtc_ratio" class="number"></span></p>
      <p><small>live data source: coinmarketcap.com, updates every 5m<small></p>

		</div>

		<div id="footer">
      <div class="col-lg-6">
        <img src="./dolphin.png" class="img-rounded img-responsive">
      </div>

			<div class="col-lg-6">
				<div class="panel panel-default">
	        <div class="panel-heading"><h3>Break Even Prices</h3></div>
	        <ul id="breakeven" class="list-group">
						 <li class="list-group-item "><h3>ETH <strong><span class="display_eth_price"></span> </strong> &#8658; <strong><span class="display_eth_breakevenprice"></span> USD</strong></h3> to reach Bitcoin marketcap. breakeven(ETH) ≝ marcap(BTC) / supply(ETH) = <span class="display_btc_marcap number"></span> / <span class="display_eth_supply number"></span></li>
						 <li class="list-group-item "><h3>BTC <strong><span class="display_btc_price"></span> </strong> &#8658; <strong><span class="display_btc_breakevenprice"></span> USD</strong></h3> to reach Ether marketcap. breakeven(BTC) ≝ marcap(ETH) / supply(BTC) = <span class="display_eth_marcap number"></span> / <span class="display_btc_supply number"></span></li>
					</ul>
      	</div>
				<div class="panel panel-default">
	        <div class="panel-heading">Reverse History of Ratios</div>
	        <ul id="events" class="list-group"></ul>
      	</div>
			</div>

		</div>


	</div>


  <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous">
  </script>
	<script src="//d3js.org/d3.v4.min.js"></script>
	<script type="text/javascript" >
	  const TIME = 60*1000*5;
    url = "https://cors-anywhere.herokuapp.com/https://api.coinmarketcap.com/v1/ticker/?limit=3";
    function round2(x){return Math.round((x + 1e-15) * 10000) / 100;}//1e-15 scaling for binary division problems
    function doPoll(){
        $.get(url, function(data) {
            console.log(data);  // process results here
            jsondata = data;
						const btc = (jsondata).filter((i,n) => i.id==="bitcoin")[0];
						const eth = (jsondata).filter((i,n) => i.id==="ethereum")[0];
            const btc_marcap = Number(btc.market_cap_usd);
            const eth_marcap = Number(eth.market_cap_usd);
						const btc_price = Number(btc.price_usd);
            const eth_price = Number(eth.price_usd);
						const btc_supply = Number(btc.available_supply);
            const eth_supply = Number(eth.available_supply);
						const btc_breakevenprice = eth_marcap/btc_supply;
						const eth_breakevenprice = btc_marcap/eth_supply;
            $('.display_btc_marcap').html(btc_marcap);
            $('.display_eth_marcap').html(eth_marcap);
						$('.display_btc_supply').html(btc_supply);
            $('.display_eth_supply').html(eth_supply);
            const ethbtc = eth_marcap / btc_marcap;
            const ethbtcpercent = Math.round(ethbtc * 100);
						const ethbtcpercent2 =  round2(ethbtc)
            $('.display_ethbtc_pc').html(ethbtcpercent);
            $('.display_ethbtc_ratio').html(ethbtc);
						$('.display_eth_price').html(Math.round(eth_price));
						$('.display_btc_price').html(Math.round(btc_price));
						$('.display_eth_breakevenprice').html(Math.round(eth_breakevenprice));
						$('.display_btc_breakevenprice').html(Math.round(btc_breakevenprice));
						$(document).prop('title', ethbtcpercent2+'% Flipper | Watchening Ethereum Flippening Happening');
            setTimeout(doPoll,TIME);

            $('.number').text(function () {
                var str = $(this).html() + '';
                x = str.split('.');
                x1 = x[0]; x2 = x.length > 1 ? '.' + x[1] : '';
                var rgx = /(\d+)(\d{3})/;
                while (rgx.test(x1)) {
                    x1 = x1.replace(rgx, '$1' + ',' + '$2');
                }
                $(this).html(x1 + x2);
            });

						$('#events').prepend('<li class="list-group-item "><strong>'+ethbtc+'</strong> '+Date()+'</li>');
        });
    }
    doPoll();
</script>

</body>
</html>
