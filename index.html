<!DOCTYPE html>
<html>
<head>

	<title>Flipper | Watchening Ethereum Flippening Happening</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

</head>

<body>

	<div id="container" class="container">
    <div class="header clearfix">
        <nav>
          <ul class="nav nav-pills pull-right">

            <li role="presentation"><a href="https://reddit.com/u/malefizer">u/malefizer</a></li>
          </ul>
        </nav>
        <h3 class="text">Flipper</h3>
      </div>

		<div id="content" class="jumbotron">

      <h2><strong>Does it flip?</strong></h2>

      <h2>ETH: <span class="text-right"><span id="display_eth_marcap" class="number"> </span> USD</span></h2>
      <h2>BTC: <span class="text-right"><span id="display_btc_marcap" class="number"> </span> USD</span></h2>

      <h1>ETH/BTC <strong>~<span id="display_ethbtc_pc"> </span>%</strong> <h1>
      <p class="text-muted">or more precise <span id="display_ethbtc_ratio" class="number"></span></p>
      <p><small>live data source: coinmarketcap.com, updates every 1m<small></p>

		</div>

		<div id="footer">
      <div class="col-lg-6">
        <img src="./dolphin.png" class="img-rounded img-responsive">
      </div>

			<div class="col-lg-6">
				<div class="panel panel-default">
	        <div class="panel-heading">Break Even Prices</div>
	        <ul id="breakeven" class="list-group">
						 <li class="list-group-item "><h3>ETH price needs to be ~<strong><span id="display_btc_breakevenprice"></span> USD</strong> to reach Bitcoin marketcap</h3></li>
						 <li class="list-group-item "><h3>BTC price needs to be ~<strong><span id="display_eth_breakevenprice"></span> USD</strong> to reach Ether marketcap</h3></li>
					</ul>
      	</div>
				<div class="panel panel-default">
	        <div class="panel-heading">Reverse History of Ratios</div>
	        <ul id="events" class="list-group"></ul>
      	</div>
			</div>

		</div>


	</div>


  <script
    src="https://code.jquery.com/jquery-3.2.1.min.js"
    integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
    crossorigin="anonymous">
  </script>
	<script src="//d3js.org/d3.v4.min.js"></script>
	<script type="text/javascript" >
    url = "https://cors-anywhere.herokuapp.com/https://api.coinmarketcap.com/v1/ticker/?limit=3";
    function round2(x){return Math.round((x + 1e-15) * 10000) / 100;}//1e-15 scaling for binary division problems
    function doPoll(){
        $.get(url, function(data) {
            console.log(data);  // process results here
            jsondata = data;
						const btc = (jsondata).filter((i,n) => i.id==="bitcoin")[0];
						const eth = (jsondata).filter((i,n) => i.id==="ethereum")[0];
            const btc_marcap = Number(btc.market_cap_usd);
            const eth_marcap = Number(eth.market_cap_usd);
						const btc_price = Number(btc.price_usd);
            const eth_price = Number(eth.price_usd);
						const btc_supply = Number(btc.available_supply);
            const eth_supply = Number(eth.available_supply);
						const btc_breakevenprice = eth_marcap/btc_supply;
						const eth_breakevenprice = btc_marcap/eth_supply;
            $('#display_btc_marcap').html(btc_marcap);
            $('#display_eth_marcap').html(eth_marcap);
            const ethbtc = eth_marcap / btc_marcap;
            const ethbtcpercent = Math.round(ethbtc * 100);
						const ethbtcpercent2 =  round2(ethbtc)
            $('#display_ethbtc_pc').html(ethbtcpercent);
            $('#display_ethbtc_ratio').html(ethbtc);
						$('#display_eth_breakevenprice').html(Math.round(eth_breakevenprice));
						$('#display_btc_breakevenprice').html(Math.round(btc_breakevenprice));
						$(document).prop('title', ethbtcpercent2+'% Flipper | Watchening Ethereum Flippening Happening');
            setTimeout(doPoll,60000);

            $('.number').text(function () {
                var str = $(this).html() + '';
                x = str.split('.');
                x1 = x[0]; x2 = x.length > 1 ? '.' + x[1] : '';
                var rgx = /(\d+)(\d{3})/;
                while (rgx.test(x1)) {
                    x1 = x1.replace(rgx, '$1' + ',' + '$2');
                }
                $(this).html(x1 + x2);
            });

						$('#events').prepend('<li class="list-group-item "><strong>'+ethbtc+'</strong> '+Date()+'</li>');
        });
    }
    doPoll();
</script>

</body>
</html>
